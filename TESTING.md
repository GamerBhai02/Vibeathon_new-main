# Testing Guide

This document describes how to test the new PDF extraction functionality and related features.

## Quick Test

Run the automated test suite:

```bash
npm run test:pdf
```

This will verify:
- ✅ PDF extraction script exists
- ✅ Python dependencies are installed
- ✅ Help command works
- ✅ Failsafe mechanisms work correctly

## Manual Testing

### 1. Test PDF Extraction Script

#### Test with non-existent file (failsafe):
```bash
python3 pdfExtraction/extract_pdf.py /tmp/nonexistent.pdf
```

Expected output:
```json
[
  {
    "topic": "File Not Found",
    "content": "The specified file '/tmp/nonexistent.pdf' could not be found."
  }
]
```

#### Test help command:
```bash
python3 pdfExtraction/extract_pdf.py --help
```

Expected: Help text showing usage and options

### 2. Test Ingest API

#### Setup:
1. Start the development server:
   ```bash
   npm run dev
   ```

2. Login to get a token (in browser or via curl)

3. Upload a PDF file:
   ```bash
   curl -X POST http://localhost:5000/api/ingest \
     -H "Authorization: Bearer YOUR_TOKEN" \
     -F "files=@/path/to/document.pdf"
   ```

Expected response:
```json
{
  "success": true,
  "topicsExtracted": 2
}
```

#### Test failsafe behavior:
Upload an invalid file - the API should still return success with fallback topics.

### 3. Test Learn API

#### Generate lesson for a topic:
```bash
curl -X POST http://localhost:5000/api/learn/generate \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"topicId": "TOPIC_ID"}'
```

Expected response:
```json
{
  "title": "Understanding Topic Name",
  "sections": [...],
  "commonMistakes": [...],
  "tips": [...],
  "confidence": "High",
  "citations": [...]
}
```

### 4. Test Mock Test Generation

#### Generate a mock test:
```bash
curl -X POST http://localhost:5000/api/mock/generate \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "examType": "Midterm",
    "duration": 7200,
    "totalMarks": 100,
    "topics": []
  }'
```

Expected: Mock exam with intelligent questions of varying difficulty.

## Browser Testing

### Test Ingest Page
1. Navigate to `/ingest`
2. Drag and drop a PDF file
3. Verify topics are extracted and displayed
4. Check that even with errors, the page doesn't crash

### Test Learn Page
1. Navigate to `/learn`
2. Select a topic from dropdown
3. Verify loading state appears
4. Verify lesson content is generated by Gemini
5. If Gemini fails, verify fallback content displays

### Test Mock Test Page
1. Navigate to `/mock-test`
2. Generate a new mock test
3. Verify questions have varied types and difficulty
4. Start and submit a test

## Error Scenarios to Test

### 1. Python Not Available
Temporarily rename Python executable and verify app still works with graceful errors.

### 2. pdfminer.six Not Installed
Uninstall pdfminer.six and verify the script returns helpful error message.

### 3. Gemini API Key Not Set
Unset `GEMINI_API_KEY` and verify:
- Ingest still works (basic extraction)
- Learn falls back to topic summary
- Mock test generates fallback questions

### 4. Invalid PDF File
Upload a non-PDF file and verify:
- No crash
- Graceful error message
- Fallback topic created

### 5. Empty PDF
Upload an empty PDF and verify appropriate message.

## Performance Testing

### Ingest Performance
Upload multiple PDFs and measure:
- Time to extract topics
- Memory usage
- No memory leaks

### Concurrent Requests
Send multiple simultaneous requests to ensure:
- No race conditions
- Proper error handling
- Each request handled independently

## Integration Testing

### Full Workflow Test
1. Login
2. Upload PDF documents
3. Verify topics appear
4. Generate study plan
5. Generate lesson for a topic
6. Generate mock test
7. Take and submit mock test
8. Verify no errors throughout

## Debugging Tips

### Check Logs
- Server logs: `console.log` and `console.error` in routes.ts
- Python logs: stderr output from extract_pdf.py

### Common Issues
1. **"Python not found"**: Install Python 3 or check PATH
2. **"pdfminer.six not found"**: Run `pip install pdfminer.six`
3. **"No topics extracted"**: Check PDF file format, may need OCR for image-based PDFs
4. **"Gemini API error"**: Check API key and quota

## Test Checklist

Before deploying:
- [ ] Run automated tests: `npm run test:pdf`
- [ ] Test file upload with valid PDF
- [ ] Test file upload with invalid file
- [ ] Test with Python not installed
- [ ] Test with pdfminer.six not installed
- [ ] Test Learn page with valid topic
- [ ] Test Learn page without Gemini API key
- [ ] Test Mock test generation
- [ ] Test full workflow end-to-end
- [ ] Verify no console errors in browser
- [ ] Check server logs for errors
- [ ] Verify build succeeds: `npm run build`
- [ ] Test in production mode: `npm start`

## Success Criteria

All tests should pass with these outcomes:
- ✅ No application crashes
- ✅ Graceful error messages displayed
- ✅ Fallback mechanisms work
- ✅ User can complete all workflows
- ✅ Performance is acceptable (< 10s per PDF)
- ✅ Memory usage is reasonable
